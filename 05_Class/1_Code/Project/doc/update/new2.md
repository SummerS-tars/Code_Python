你好！很高兴听到你已经完成了 Phase 5 和 6。这意味着你的系统现在已经具备了“智能搜索”和“数据获取”的基础能力。

针对你提出的三个新需求（**环线自动化处理**、**GUI 美化**、**特殊线路逻辑**），我进行了深度的技术拆解。目前的“链表+图”模型其实非常适合处理这些情况，但需要在**数据预处理**和**权重计算**上做一点“手术”。

以下是详细的解决方案和更新后的开发文档。

---

### 一、 核心逻辑解决方案

#### 1. 自动化获取并处理“环线” (Line 4)

* **问题现状**：高德 API 返回的 4 号线数据通常是“C型”开口的（例如：从“宜山路”开始，到“上海体育馆”结束）。但在物理上，它们首尾相连。如果不在 CSV 里闭合，算法会认为这两个站不通。
* **自动化方案**：
* 在 `DataFetcher` 中维护一个**白名单**（如 `LOOP_LINES = ['4号线']`）。
* 抓取数据时，如果发现是环线，且 `第一个站 != 最后一个站`，则强制将**第一个站的信息复制一份**，追加到列表末尾。
* **CSV 表现**：4 号线的 CSV 行里，最后一行会多出一个“宜山路”，且它会拥有一个新的 `站点ID`。
* **程序处理**：`DataLoader` 会正常读取。因为名字都叫“宜山路”，`MetroNetwork` 会自动建立换乘连接。
* **关键点**：这会导致“同站换乘”的情况（从 ID=1 的宜山路换到 ID=500 的宜山路）。我们需要在算法里将这种换乘的代价设为 **0**。



#### 2. 处理“分叉线路” (Line 10, 11)

* **问题现状**：Line 10 有主线（到虹桥火车站）和支线（到航中路）。如果都叫“10号线”，`DataLoader` 会把它们强行串在一起，导致从“虹桥火车站”直接跳到“航中路”的虫洞 bug。
* **自动化方案**：
* 在 `DataFetcher` 中检测**线路名重复**。
* 如果“10号线”出现了第二次，且站点序列不一样，则自动将其重命名为 **“10号线(支线)”**。


* **程序处理**：
* 主线和支线在公共站点（如“龙溪路”）会有同名站点。
* 算法会自动建立换乘连接。
* **关键点**：同样，我们需要告诉算法，从“10号线”换到“10号线(支线)”属于**系统内换乘**，代价为 **0**。



---

### 二、 Phase 7 GUI 美化方案 (告别平庸)

目前的 GUI 是标准的“工程师审美”（输入框+文本域）。为了让它看起来更现代、专业，我们不再使用简单的 `Text` 组件打印文字，而是采用 **“卡片式布局” (Card Layout)** 和 **“可视化绘图”**。

* **色彩系统**：为每条线路定义颜色（如 1号线红色，2号线绿色，10号线淡紫）。
* **结果展示**：使用 `tk.Canvas` 或 `ScrolledFrame`。
* **时间轴设计**：
* 左侧绘制一条竖线（时间轴）。
* 每个站点是一个圆点。
* 换乘站用大圆点或特殊图标。
* 不同线路的竖线颜色不同。



---

### 三、 新的开发阶段文档 (v4.0)

我将之前的 Phase 6（数据部分）进行了逻辑升级，并完全重写了 Phase 7（UI 部分）。

请将以下 Prompt 分阶段发给你的 IDE Agent。

### 建议

建议你先执行 **Phase 6 (Refined)**。修复数据拓扑是基础，否则再漂亮的界面画出来的也是错误的路径（比如 4 号线可能会画出一个断开的半圆）。

待 Phase 6 验证 10 号线和 4 号线逻辑正常后，再进行 Phase 7 的界面大改。
