# Part 5 更多

## 1. 课件11：文件与交互

突破内存易失性的限制，通过文件系统实现数据的持久化存储  

### 1.1. 文件读写基础与持久化概念

持久化：  
数据在程序结束后依然存在，通常通过文件系统实现。  

必要性：  
内存中的数据在程序终止后会丢失，文件存储可以保存重要信息。  

#### 1.1.1. 核心函数

`open()`: 打开文件，返回文件对象。  

常用参数：  

- 文件路径：字符串，指定文件位置。  
- 模式：字符串，指定文件操作类型，如 'r'（读取）、'w'（写入）、'a'（追加）、'b'（二进制模式）等。  
    - 'r'：只读模式，文件必须存在。  
    - 'w'：写入模式，文件不存在则创建，存在则覆盖。  
    - 'a'：追加模式，文件不存在则创建，存在则在末尾添加内容。  
    - 'b'：二进制模式，用于非文本文件，如图片、音频等。  
    - '+'：读写模式，可与其他模式结合使用，如 'r+'、'w+'。  
        实现双向操作  
        - 'r+'：读写模式，文件必须存在。  
        - 'w+'：写入读模式，文件不存在则创建，存在则覆盖。  
- 编码：字符串，指定文件编码格式，如 'utf-8'。

#### 1.1.2. 最佳实践

使用 `with` 语句管理文件上下文，确保文件正确关闭：  

```python
with open('file.txt', 'r', encoding='utf-8') as file:
    content = file.read()
    # 文件在此块结束后自动关闭
```

它能确保代码块执行完毕后自动安全关闭文件，防止数据损坏或资源泄露

### 1.2. 结构化数据：CSV读写

CSV：Comma-Separated Values，逗号分隔值文件，用于存储表格数据的文本文件格式。  

#### 1.2.1. 读写CSV文件

模块：  
`csv`：Python标准库中的模块，提供读写CSV文件的功能。  

读取：  
`csv.reader()`：创建一个读取器对象，用于逐行读取CSV文件内容。  

参数：文件对象  
返回值：迭代器

每一行解析为一个字符串列表。  

方法：  

- `next()`: 读取下一行数据。

写入：  
`csv.writer()`：创建一个写入器对象，用于将数据写入CSV文件。  
方法：  

- `writerow()`: 写入一行数据。
- `writerows()`: 写入多行数据。

写入时，建议使用 `newline=''` 参数打开文件，防止多余空行出现：  

### 1.3. 复杂数据：JSON读写

JSON（JavaScript Object Notation）：一种轻量级的数据交换格式，易于人阅读和编写，同时也易于机器解析和生成。  

网络API的事实标准格式  
语法与字典和列表几乎相同  

#### 1.3.1. 读写JSON文件

模块：  
`json`：Python标准库中的模块，提供读写JSON文件的功能。  

文件操作：  

- `json.dump(obj, file)`: 将Python对象 `obj` 序列化为JSON格式，并写入文件对象 `file`。  
- `json.load(file)`: 从文件对象 `file` 中读取JSON数据，并反序列化为Python对象。  

内存字符串操作：  

- `json.dumps(obj)`: 将Python对象 `obj` 序列化为JSON格式的字符串。  
- `json.loads(s)`: 将JSON格式的字符串 `s` 反序列化为Python对象。  

优势：  
能完美表示嵌套和层级结构，支持布尔值（对应 JSON 的 true/false）和空值（对应 JSON 的 null）的自动转换

### 1.4. 实践中的文件处理

防御性编程  
文件系统中可能存在的异常很多  
注意异常处理  

常见异常：  

- `FileNotFoundError`: 文件未找到。  
- `PermissionError`: 权限不足。  
- `JSONDecodeError`: JSON解码错误。  
- `IOError`: 输入输出错误。

实例：配置加载器  
读取、校验、写入默认值分别封装为纯函数  
配置文件损坏或丢失，程序应能自动创建并使用预设的默认值，确保系统稳定启动  

## 2. 课件12：第三方模块应用

如何安装第三方库  

利用 Pandas 进行数据预处理  

通过 Matplotlib 和 Seaborn 实现数据可视化  

### 2.1. 第三方模块的安装与管理

核心工具：  
`pip`：Python的包管理工具，用于安装和管理第三方库。  

常用命令：  

- 安装：  
    `pip install package_name`：安装指定的包。

- 卸载：  
    `pip uninstall package_name`：卸载指定的包。  

- 查看已安装包：  
    `pip list`：列出所有已安装的包及其版本。
    `pip list`：列出所有已安装的包及其版本。  

- 显示包信息：  
    `pip show package_name`：显示指定包的详细信息。  

#### 2.1.1. 包

包（Package）的概念：  
包是包含多个模块的目录，目录中必须包含一个 `__init__.py` 文件  
用于标识该目录为一个包。  

### 2.2. 数据预处理

Data Preprocessing  
垃圾进，垃圾出  
数据清洗在数据分析中占据重要地位，占时一般也是最多的  

#### 2.2.1. 数据清理

- 缺失值处理：  
    - `isnull()`: 检测缺失值。  
    - `dropna()`: 删除缺失值。  
    - `fillna()`: 填充缺失值。  
    - `ffill()`: 向前填充缺失值。  
    - `bfill()`: 向后填充缺失值。  
- 重复值处理：  
    - `duplicated()`: 检测重复值。  
    - `drop_duplicates()`: 删除重复值。  
- 异常值处理：  
    - 四分位距（IQR）法：计算Q1和Q3，定义异常值范围。  
        小于下界 $Q1 - 1.5 \times IQR$ 的值  
        或者大于上界 $Q3 + 1.5 \times IQR$ 的值  
        可通过 箱体图 或 小提琴图 进行可视化检测。  
- 数据集成：  
    - 合并：  
        `pd.merge()`: 基于键合并数据集。  
    - 堆叠：  
        `pd.concat()`: 沿指定轴连接数据集。  
        按行或列方向堆叠多个数据集  
        有点类似于关系运算中的连接  
- 数据转换：  
    - 标准化：  
        - Z-score 标准化：均值为0，标准差为1。  
        - Min-Max 标准化：缩放到指定范围（通常为0到1）。
    - 离散化：  
        - `pd.cut()`: 将连续变量分箱。  
            例如将年龄分为青年、中年、老年等类别。  
        - `pd.qcut()`: 基于分位数分箱。  
- 数据规约（Data Reduction）：  
    主成分分析（PCA）：通过线性变换将高维数据映射至低维空间，保留主要信息。  
    常用于多维数据可视化  

### 2.3. 数据可视化

两种主要绘图库及应用场景：  

#### 2.3.1. Matplotlib 基础

- 图表结构  
    - Figure：图表容器。  
    - Axes：坐标系。  
    - Axis：坐标轴。
    - Subplot：子图。
- 绘图流程  
    1. 准备数据  
    2. 绘制图形  
    3. 保存或显示图形  
- 基础图形  
    - scatter： 散点图。
    - bar：柱状图。
    - hist：直方图。
    - plot：折线图。
    - pie：饼图。

#### 2.3.2. Seaborn 高阶绘图

- 优势：  
    语法简介，内置美观调色板（palette），适合统计图表绘制。  
- 高阶图形：  
    - 小提琴图（violinplot）：显示数据分布及其概率密度。  
    - 箱线图（boxplot）：显示数据的分位数及异常值。  
    - 回归模型图（lmplot）：显示变量间的线性关系及回归线。  
    - 成对图（pairplot）：显示多变量间的两两关系。  

#### 2.3.3. PandasAI 简介

PandasAI：基于大语言模型（如 GPT-4）构建的库，旨在简化数据分析过程。  
使得用户能够通过自然语言直接与数据交互，实现自动清洗和查询等功能。  

## 3. 课件13：API开发实战

通过程序与互联网服务进行数据交互  

### 3.1. HTTP API

API本质：  
Application Programming Interface，应用程序编程接口。  
标准化的通信协议和数据格式  

HTTP协议基础：  

- 请求结构：  
    - 请求行
        方法、URL  
        常用方法：  
        - GET：请求数据。
        - POST：提交数据。
        - PUT：更新数据。
        - DELETE：删除数据。
        Python `requests` 库会自动处理URL的参数编码  
        URL：  
        - 协议（http/https）  
        - 主机名（域名或IP地址）  
        - 路径  
        - 查询参数  
    - 请求头  
        例如User-Agent、Content-Type等  
    - 请求体  
        数据  

- 响应结构：  
    - 状态行  
        状态码、状态消息  
        常见状态码：200（成功）、404（未找到）、500（服务器错误）等  
    - 响应头  
        例如Content-Type、Content-Length等  
    - 响应体  
        数据

### 3.2. 重要库：Requests

Requests：Python中用于发送HTTP请求的第三方库。  

#### 3.2.1. 基础调用

- `requests.get(url, params=None, **kwargs)`: 发送GET请求。  
- `requests.post(url, data=None, json=None, **kwargs)`: 发送POST请求。  

#### 3.2.2. 进阶配置

- 请求头（Headers）：  
    通过 `headers` 参数自定义请求头。  
    伪装`User-Agent` 防止被服务器拒绝访问。  
- 超时与重试：  
    通过 `timeout` 参数设置请求超时时间。  
    否则可能永久阻塞程序  
    使用 `requests.adapters.HTTPAdapter` 配置重试策略。
- 会话保持：  
    `requests.Session()`: 创建会话对象，保持跨请求的参数（如Cookies）。  
    可以复用连接，提高性能。  
- SSL验证：  
    默认验证HTTPS证书，可通过 `verify` 参数禁用验证（不推荐）。  
    一般仅测试环境禁用绕过  

### 3.3. JSON数据解析与处理

现代Web API通常使用JSON格式传输数据  

处理方法：  

- 自动解析：  
    `response.json()`: 将响应体解析为Python对象（字典或列表）。  
- 安全读取：  
    访问嵌套字典时，使用`.get()` 方法并设置默认值，避免KeyError异常。  
- 批量提取：  
    使用列表推导式或循环遍历提取所需字段。  
- 时间转换：  
    使用 `datetime` 模块将时间戳转换为可读格式。  
    例如 `strptime()` 和 `strftime()` 方法。  

### 3.4. 优秀实践方法

1. 异常捕获  
2. 状态检查  
3. 数据清洗  
4. 安全建议：  
    - 避免在URL中传递敏感信息。  
    - 使用环境变量或配置文件存储API密钥。  
        不要将密钥硬编码在代码中。  
    - 定期更新依赖库，修补安全漏洞。  

## 4. 课件14：大模型开发实战

从“与大模型聊天”到“在程序中调用大模型”  

目标：  
理解LLM的API调用机制  
掌握本地部署模型的集成方式  
且能将LLM嵌入到实际应用流程  

工程视角：  
LLM——可调用的服务  
程序通过API传入数据，获取并解析结果  

### 4.1. 环境搭建：Ollama本地部署  

Ollama平台：  

- 优势：  
    本地部署，支持标准API调用，且适合CPU运行。  
- 模型：  
    Qwen3:0.6b  
- 安装指令：  
    `ollama pull qwen3:0.6b`  

### 4.2. 大模型API基础调用

Python集成：  
使用`ollama` Python包调用本地模型。  

核心函数：  
`chat()`  

- `model`: 模型名称。  
- `messages`结构：  
    包含字典的列表  
    对话的核心  

三大角色：  

- `system`：系统角色，设定对话背景。  
    一般用于定义规则、身份和输出格式  
- `user`：用户角色，发送对话信息。  
    具体的输入数据或问题  
- `assistant`：助手角色，返回对话结果。  
    模型的输出结果或存储的历史对话  

进阶参数：  

- `stream=True`：启用流式响应，逐步获取结果。  
    类似“打字机”式的输出效果  
- `think=True`：模型输出其推理过程，显示`[思考中]`标签  
    助于理解AI的逻辑  

### 4.3. 实践案例：问卷自动分析

通过问卷处理展示传统编程于AI结合的优势  

- 混合处理模式：  
    - 单选/多选题：通过 Python 传统逻辑进行统计分析。
    - 开放性文字题：循环调用 LLM API 进行文本情感分析、主题提取和建议汇总

- 多轮调用与多轮对话的比较：  
    自动化处理中，程序通常为“多轮调用”  
    每条问卷记录发起一次独立API求情  
    将模型作为一个系统的“分析模块”来应用  

### 4.4. 代码伦理与安全性

- 幻觉问题  
    模型分析可能出错，注意分析，辩证使用  
- 隐私问题  
    避免上传敏感个人信息，确保数据安全
- 学术诚信  
    使用AI辅助时，注意引用和标注，避免抄袭风险  
