# Part 5 更多

## 1. 课件11：文件与交互

突破内存易失性的限制，通过文件系统实现数据的持久化存储  

### 1.1. 文件读写基础与持久化概念

持久化：  
数据在程序结束后依然存在，通常通过文件系统实现。  

必要性：  
内存中的数据在程序终止后会丢失，文件存储可以保存重要信息。  

#### 1.1.1. 核心函数

`open()`: 打开文件，返回文件对象。  

常用参数：  

- 文件路径：字符串，指定文件位置。  
- 模式：字符串，指定文件操作类型，如 'r'（读取）、'w'（写入）、'a'（追加）、'b'（二进制模式）等。  
    - 'r'：只读模式，文件必须存在。  
    - 'w'：写入模式，文件不存在则创建，存在则覆盖。  
    - 'a'：追加模式，文件不存在则创建，存在则在末尾添加内容。  
    - 'b'：二进制模式，用于非文本文件，如图片、音频等。  
    - '+'：读写模式，可与其他模式结合使用，如 'r+'、'w+'。  
        实现双向操作  
        - 'r+'：读写模式，文件必须存在。  
        - 'w+'：写入读模式，文件不存在则创建，存在则覆盖。  
- 编码：字符串，指定文件编码格式，如 'utf-8'。

#### 1.1.2. 最佳实践

使用 `with` 语句管理文件上下文，确保文件正确关闭：  

```python
with open('file.txt', 'r', encoding='utf-8') as file:
    content = file.read()
    # 文件在此块结束后自动关闭
```

它能确保代码块执行完毕后自动安全关闭文件，防止数据损坏或资源泄露

### 1.2. 结构化数据：CSV读写

CSV：Comma-Separated Values，逗号分隔值文件，用于存储表格数据的文本文件格式。  

#### 1.2.1. 读写CSV文件

模块：  
`csv`：Python标准库中的模块，提供读写CSV文件的功能。  

读取：  
`csv.reader()`：创建一个读取器对象，用于逐行读取CSV文件内容。  

参数：文件对象  
返回值：迭代器

每一行解析为一个字符串列表。  

方法：  

- `next()`: 读取下一行数据。

写入：  
`csv.writer()`：创建一个写入器对象，用于将数据写入CSV文件。  
方法：  

- `writerow()`: 写入一行数据。
- `writerows()`: 写入多行数据。

写入时，建议使用 `newline=''` 参数打开文件，防止多余空行出现：  

### 1.3. 复杂数据：JSON读写

JSON（JavaScript Object Notation）：一种轻量级的数据交换格式，易于人阅读和编写，同时也易于机器解析和生成。  

网络API的事实标准格式  
语法与字典和列表几乎相同  

#### 1.3.1. 读写JSON文件

模块：  
`json`：Python标准库中的模块，提供读写JSON文件的功能。  

文件操作：  

- `json.dump(obj, file)`: 将Python对象 `obj` 序列化为JSON格式，并写入文件对象 `file`。  
- `json.load(file)`: 从文件对象 `file` 中读取JSON数据，并反序列化为Python对象。  

内存字符串操作：  

- `json.dumps(obj)`: 将Python对象 `obj` 序列化为JSON格式的字符串。  
- `json.loads(s)`: 将JSON格式的字符串 `s` 反序列化为Python对象。  

优势：  
能完美表示嵌套和层级结构，支持布尔值（对应 JSON 的 true/false）和空值（对应 JSON 的 null）的自动转换

### 1.4. 实践中的文件处理

防御性编程  
文件系统中可能存在的异常很多  
注意异常处理  

常见异常：  

- `FileNotFoundError`: 文件未找到。  
- `PermissionError`: 权限不足。  
- `JSONDecodeError`: JSON解码错误。  
- `IOError`: 输入输出错误。

实例：配置加载器  
读取、校验、写入默认值分别封装为纯函数  
配置文件损坏或丢失，程序应能自动创建并使用预设的默认值，确保系统稳定启动  

## 2. 课件12：第三方模块应用

如何安装第三方库  

利用 Pandas 进行数据预处理  

通过 Matplotlib 和 Seaborn 实现数据可视化  

### 2.1. 第三方模块的安装与管理

核心工具：  
`pip`：Python的包管理工具，用于安装和管理第三方库。  

常用命令：  

- 安装：  
    `pip install package_name`：安装指定的包。

- 卸载：  
    `pip uninstall package_name`：卸载指定的包。  

- 查看已安装包：  
    `pip list`：列出所有已安装的包及其版本。
    `pip list`：列出所有已安装的包及其版本。  

- 显示包信息：  
    `pip show package_name`：显示指定包的详细信息。  

#### 2.1.1. 包

包（Package）的概念：  
包是包含多个模块的目录，目录中必须包含一个 `__init__.py` 文件  
用于标识该目录为一个包。  

### 2.2. 数据预处理

Data Preprocessing  
垃圾进，垃圾出  
数据清洗在数据分析中占据重要地位，占时一般也是最多的  

#### 2.2.1. 数据清理

- 缺失值处理：  
    - `isnull()`: 检测缺失值。  
    - `dropna()`: 删除缺失值。  
    - `fillna()`: 填充缺失值。  
    - `ffill()`: 向前填充缺失值。  
    - `bfill()`: 向后填充缺失值。  
- 重复值处理：  
    - `duplicated()`: 检测重复值。  
    - `drop_duplicates()`: 删除重复值。  
- 异常值处理：  
    - 四分位距（IQR）法：计算Q1和Q3，定义异常值范围。  
        小于下界 $Q1 - 1.5 \times IQR$ 的值  
        或者大于上界 $Q3 + 1.5 \times IQR$ 的值  
        可通过 箱体图 或 小提琴图 进行可视化检测。  
- 数据集成：  
    - 合并：  
        `pd.merge()`: 基于键合并数据集。  
    - 堆叠：  
        `pd.concat()`: 沿指定轴连接数据集。  
        按行或列方向堆叠多个数据集  
        有点类似于关系运算中的连接  
- 数据转换：  
    - 标准化：  
        - Z-score 标准化：均值为0，标准差为1。  
        - Min-Max 标准化：缩放到指定范围（通常为0到1）。
    - 离散化：  
        - `pd.cut()`: 将连续变量分箱。  
            例如将年龄分为青年、中年、老年等类别。  
        - `pd.qcut()`: 基于分位数分箱。  
- 数据规约（Data Reduction）：  
    主成分分析（PCA）：通过线性变换将高维数据映射至低维空间，保留主要信息。  
    常用于多维数据可视化  

### 2.3. 数据可视化

两种主要绘图库及应用场景：  

#### 2.3.1. Matplotlib 基础

- 图表结构  
    - Figure：图表容器。  
    - Axes：坐标系。  
    - Axis：坐标轴。
    - Subplot：子图。
- 绘图流程  
    1. 准备数据  
    2. 绘制图形  
    3. 保存或显示图形  
- 基础图形  
    - scatter： 散点图。
    - bar：柱状图。
    - hist：直方图。
    - plot：折线图。
    - pie：饼图。

#### 2.3.2. Seaborn 高阶绘图

- 优势：  
    语法简介，内置美观调色板（palette），适合统计图表绘制。  
- 高阶图形：  
    - 小提琴图（violinplot）：显示数据分布及其概率密度。  
    - 箱线图（boxplot）：显示数据的分位数及异常值。  
    - 回归模型图（lmplot）：显示变量间的线性关系及回归线。  
    - 成对图（pairplot）：显示多变量间的两两关系。  

#### 2.3.3. PandasAI 简介

PandasAI：基于大语言模型（如 GPT-4）构建的库，旨在简化数据分析过程。  
使得用户能够通过自然语言直接与数据交互，实现自动清洗和查询等功能。  
