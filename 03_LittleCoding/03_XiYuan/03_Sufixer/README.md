# Suffixer Script

这个脚本用于处理包含数字文件夹的目录结构，对其中的 `.png` 图片文件进行重命名并移动到根目录。

## 功能特性

1. **递归处理嵌套结构**：支持处理多级嵌套的数字文件夹
2. **文件夹重新编号**：自动将不连续的数字文件夹映射为从 1 开始的连续编号
3. **处理根目录图片**：处理与数字文件夹同级的图片文件
4. **连续编号**：跨多个文件夹保持编号的连续性
5. **Dry-run 预演模式**：支持“不落地演练”，仅打印将要执行的改名与移动，不改动任何文件

## 命名规则

- **子文件夹中的图片**：`原文件名_文件夹编号_图片序号.png`
  - 例如：`image_1_1.png`, `image_1_2.png`
- **根目录的图片**：`原文件名_N_1.png`
  - N 从最后一个文件夹编号+1开始递增

## 使用方法

1. **运行脚本**：使用 Python 执行 `sufixer.py` 文件（Windows PowerShell）

    ```powershell
    python .\sufixer.py
    ```
  
2. **选择文件夹**：在弹出的对话框中选择包含数字文件夹的根目录
  
3. **是否 Dry-run**：会在控制台提示：`Run as dry-run (no changes)? [y/N]:`。输入 `y`/`yes` 将以预演模式运行，不会对任何文件进行改动；留空或输入其他将进行实际改动。

4. **处理过程**：脚本会自动：

    - 扫描所有数字命名的子文件夹
    - 将不连续的文件夹编号映射为连续编号（从1开始）
    - 递归处理嵌套的数字文件夹结构
    - 重命名所有 `.png` 文件并移动到根目录
    - 处理根目录中与数字文件夹同级的图片

5. **完成**：脚本会在控制台显示处理进度，所有重命名的文件将位于根目录；在 Dry-run 模式下会显示“DRY-RUN completed. No changes were made.”

## 示例

假设目录结构如下：

```text
root/
├── 3/
│   ├── 5/
│   │   ├── img1.png
│   │   └── img2.png
│   └── 8/
│       └── img3.png
├── 10/
│   └── img4.png
└── photo.png
```

处理后，根目录将包含：

- `img1_1_1.png` (来自文件夹 3/5，映射为 1)
- `img2_1_2.png` (来自文件夹 3/5，映射为 1)
- `img3_2_1.png` (来自文件夹 3/8，映射为 2)
- `img4_3_1.png` (来自文件夹 10，映射为 3)
- `photo_4_1.png` (根目录图片)

## 常见问题 FAQ

- Q: 有时会出现“重复添加后缀”，例如 `xxx_2_1.png` 又变成 `xxx_2_1_314_1.png`？
  - A: 该问题已修复。现在脚本在进入每一级目录后会对“该级目录原本存在的 PNG 文件”进行快照，仅处理这批快照文件，避免了递归过程中移动回根目录的新文件被再次发现与处理，从而杜绝重复加后缀。

- Q: 如果目标文件名已存在会如何处理？
  - A: 在子文件夹图片重命名时，会在第二位序号上递增以规避冲突；对于根目录图片重命名，同样会在“文件夹编号位”上递增以获得不冲突的目标名。若仍冲突，系统会继续递增直到找到可用名。

## 系统要求

- Python 3.x
- Tkinter (通常随 Python 一起安装)
